---
layout: default
title: Carte de mes lieux
---
  <!-- Carte -->
  <div id="map"></div>

  <!-- Panneau flottant -->
  <aside id="nav-panel" class="nav-panel">
    <div class="nav-section">
      <input type="text" id="search-input" placeholder="Rechercher un lieu" title="Rechercher un lieux">
    </div>

    <div class="nav-section">
         <ul class="sort-by-alphabetical">
         <li>
            <a class="nav-item" href="{{ '/voyages.html' | relative_url }}">
               <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 2.5C13.7956 2.5 14.5585 2.8163 15.1211 3.37891C15.6837 3.94152 16 4.70435 16 5.5C16.7956 5.5 17.5585 5.8163 18.1211 6.37891C18.6837 6.94152 19 7.70435 19 8.5V18.5C19 19.2957 18.6837 20.0585 18.1211 20.6211C17.5585 21.1837 16.7957 21.5 16 21.5C16 22.0523 15.5523 22.5 15 22.5C14.4477 22.5 14 22.0523 14 21.5H10C10 22.0523 9.55228 22.5 9 22.5C8.44772 22.5 8 22.0523 8 21.5C7.20435 21.5 6.44152 21.1837 5.87891 20.6211C5.3163 20.0585 5 19.2956 5 18.5V8.5C5 7.70435 5.3163 6.94152 5.87891 6.37891C6.44152 5.8163 7.20435 5.5 8 5.5C8 4.70435 8.3163 3.94152 8.87891 3.37891C9.44152 2.8163 10.2044 2.5 11 2.5H13ZM7 18.5L7.00488 18.5986C7.02757 18.8276 7.12883 19.0429 7.29297 19.207C7.48051 19.3946 7.73478 19.5 8 19.5H16C16.2652 19.5 16.5195 19.3946 16.707 19.207C16.8946 19.0195 17 18.7652 17 18.5V17.5H7V18.5ZM7 15.5H17V11.5H7V15.5ZM8 7.5C7.73478 7.5 7.48051 7.60543 7.29297 7.79297C7.10543 7.98051 7 8.23478 7 8.5V9.5H17V8.5C17 8.23478 16.8946 7.98051 16.707 7.79297C16.5429 7.62883 16.3276 7.52757 16.0986 7.50488L16 7.5H8ZM11 4.5C10.7348 4.5 10.4805 4.60543 10.293 4.79297C10.1054 4.98051 10 5.23478 10 5.5H14C14 5.23478 13.8946 4.98051 13.707 4.79297C13.5429 4.62883 13.3276 4.52757 13.0986 4.50488L13 4.5H11Z" fill=""/></svg>
               <span class="nav-item-label">Voyages</span>
            </a>
         </li>
      </ul>
    </div>

    <div class="nav-section">
      <h3>Tags</h3>
      <div id="tags-list" class="sort-by-alphabetical">
      {% assign all_tags = site.places | map: "tags" | join: "," | split: "," | uniq | sort %}
      {% for tag in all_tags %}
         {% assign clean_tag = tag | strip %}
         {% if clean_tag and clean_tag != "" %}
            <label class="nav-item">
            <input type="checkbox" value="{{ clean_tag }}" class="tag-checkbox">
            <span class="checkbox-icon"></span>
            {{ clean_tag }}
            </label>
         {% endif %}
      {% endfor %}
      </div>

      <button id="clear-filters" class="btn btn-primary" style="display:none;">Supprimer les filtres</button>
    </div>
  </aside>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("search-input");
    const clearFiltersBtn = document.getElementById("clear-filters");

    let activeSearch = "";
    let activeVoyage = null;
    let activeTags = [];

    // Initialisation carte
    const map = L.map('map').setView([46.8, 2.2], 6);
    L.tileLayer('https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png?api_key=cbccb69c-bd70-401f-a8ce-ade95addcf4d', {
      maxZoom: 20,
      attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, ' +
                   '&copy; <a href="https://openmaptiles.org/">OpenMapTiles</a>, ' +
                   '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // Données générées par Jekyll
    const placesData = [
      {% for place in site.places %}
        {% if place.lat and place.lon %}
          {
            title: {{ place.title | jsonify }},
            description: {{ place.description | default: place.description | default: "" | jsonify }},
            lat: {{ place.lat }},
            lon: {{ place.lon }},
            voyage: {{ place.voyage | default: "" | jsonify }},
            tags: [
              {% for tag in place.tags %}
                {{ tag | jsonify }}{% unless forloop.last %},{% endunless %}
              {% endfor %}
            ],
            url: {{ place.url | jsonify }},
            date: {{ place.date | default: "" | jsonify }}
          }{% unless forloop.last %},{% endunless %}
        {% endif %}
      {% endfor %}
    ];

    const markers = [];
    placesData.forEach((place, index) => {
      const svgIcon = L.divIcon({
        className: "custom-svg-pin",
        html: `
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="42" viewBox="0 0 30 42">
            <path d="M15 0C6.7 0 0 6.7 0 15c0 11.3 15 27 15 27s15-15.7 15-27C30 6.7 23.3 0 15 0z" fill="#202020"/>
            <circle cx="15" cy="15" r="6" fill="#fff"/>
          </svg>
        `,
        iconSize: [30, 42],
        iconAnchor: [15, 42],
        popupAnchor: [0, -42]
      });
      
      const marker = L.marker([place.lat, place.lon], { icon: svgIcon }).addTo(map);
      
      let popupContent = `
        <h4><a href="${place.url}">${place.title}</a></h4>
        <p>${place.description}</p>
        ${place.tags && place.tags.length > 0 ? `<div class="tags">${place.tags.map(tag => `<span class="tag">${tag}</span>`).join("")}</div>` : ""}
      `;
      
      marker.bindPopup(popupContent);
      
      markers.push({
        element: marker,
        title: (place.title || "").toLowerCase(),
        voyage: place.voyage || "",
        tags: place.tags || []
      });
    });

    function updateMap() {
      const visibleMarkers = markers.filter(m => {
        let visible = true;
        if (activeSearch && !m.title.includes(activeSearch)) visible = false;
        if (activeVoyage && m.voyage !== activeVoyage) visible = false;
        if (activeTags.length > 0 && !activeTags.every(tag => m.tags.includes(tag))) visible = false;

        if (visible) {
          if (!map.hasLayer(m.element)) m.element.addTo(map);
        } else {
          if (map.hasLayer(m.element)) map.removeLayer(m.element);
        }
        return visible;
      });

      if (visibleMarkers.length > 0) {
        const group = L.featureGroup(visibleMarkers.map(m => m.element));
        map.fitBounds(group.getBounds().pad(0.1));
      }

      clearFiltersBtn.style.display = (activeTags.length > 0 || activeVoyage || activeSearch) ? "block" : "none";
      document.querySelectorAll('.voyage-link').forEach(link => {
        link.classList.toggle('active', link.dataset.voyage === activeVoyage);
      });
    }

    searchInput.addEventListener("input", function () {
      activeSearch = this.value.toLowerCase();
      updateMap();
    });

    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('voyage-link')) {
        e.preventDefault();
        const voyage = e.target.dataset.voyage;
        activeVoyage = activeVoyage === voyage ? null : voyage;
        updateMap();
      }
    });

    document.addEventListener('change', function(e) {
      if (e.target.classList.contains('tag-checkbox')) {
        const tagCheckboxes = document.querySelectorAll('.tag-checkbox');
        activeTags = Array.from(tagCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
        updateMap();
      }
    });

    clearFiltersBtn.addEventListener("click", function() {
      activeSearch = "";
      activeVoyage = null;
      activeTags = [];
      searchInput.value = "";
      document.querySelectorAll('.tag-checkbox').forEach(cb => cb.checked = false);
      document.querySelectorAll('.voyage-link').forEach(link => link.classList.remove('active'));
      markers.forEach(m => { if (!map.hasLayer(m.element)) m.element.addTo(map); });
      if (markers.length > 0) {
        const allMarkersGroup = L.featureGroup(markers.map(m => m.element));
        map.fitBounds(allMarkersGroup.getBounds().pad(0.1));
      }
      updateMap();
    });

    // Initialisation
    updateMap();
    if (markers.length > 0) {
      const allMarkersGroup = L.featureGroup(markers.map(m => m.element));
      map.fitBounds(allMarkersGroup.getBounds().pad(0.1));
    }
  });
  </script>
</body>
</html>